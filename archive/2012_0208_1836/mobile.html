<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no"/>
 
        <style type="text/css">
			body {
				margin: 0;
				padding: 5px;
				font-size: 1em;
			}
            h2 {
                text-align: center;
			}
            h2 a {
                text-decoration: none;
            }
            #_1pass4all_wrapper {
                margin: 2px auto;
                width: 100%;
			}
        </style>
        <title>1Pass4All</title>
    </head>
    <body>
        <h2><a href="http://hzheng.github.com/1pass4all">1Pass4All (version 0.2.0)</a></h2>
        <div id="_1pass4all_wrapper"/>
        <script>
(function(){
function str2bin(a){for(var b=[],d=0,c=a.length<<3;d<c;d+=8)b[d>>5]|=(a.charCodeAt(d>>3)&255)<<24-(d&31);return b}function bin2hex(a){for(var b="",d=0,c=a.length<<2;d<c;++d)b+="0123456789abcdef".charAt(a[d>>2]>>(3-(d&3)<<3)+4&15),b+="0123456789abcdef".charAt(a[d>>2]>>(3-(d&3)<<3)&15);return b}function shortenBitBlock(a,b,d){for(var c=[],e=(1<<d)-1,f=a.length-1,g=b;0<g;g-=d){var i=a[f],j=d;g<d&&0<=--f&&(i|=(a[f]&(1<<d-g)-1)<<g,j-=g,g+=b);c.unshift(i&e);if(0>f)break;a[f]>>>=j}return c}
function base94(a){a=shortenBitBlock(a,32,7);a=a.map(function(a){return 94>a?String.fromCharCode(33+a):""});return a.join("")}function add(a,b){return(a&2147483647)+(b&2147483647)^a&2147483648^b&2147483648}function rightRotate(a,b){return a>>>b|a<<32-b}if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var d=[],c=b||window,e=0;e<this.length;++e)e in this&&(d[e]=a.call(c,this[e],e,this));return d};
var hasher={sha256:function(a,b){return this._sha256Hash(str2bin(a),a.length<<3,b)},_sha256Hash:function(a,b,d){var c=d?[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]:[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,
604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=[];a[b>>5]|=128<<
24-(b&31);a[(b+64>>9<<4)+15]=b;for(b=0;b<a.length;b+=16){for(var g=c[0],i=c[1],j=c[2],p=c[3],k=c[4],n=c[5],o=c[6],q=c[7],h=0;64>h;++h){if(16>h)f[h]=a[h+b];else{var m=rightRotate(f[h-15],7)^rightRotate(f[h-15],18)^f[h-15]>>>3,l=rightRotate(f[h-2],17)^rightRotate(f[h-2],19)^f[h-2]>>>10;f[h]=add(add(add(l,f[h-7]),m),f[h-16])}var m=rightRotate(g,2)^rightRotate(g,13)^rightRotate(g,22),m=add(m,g&i^g&j^i&j),l=rightRotate(k,6)^rightRotate(k,11)^rightRotate(k,25),r=k&n^~k&o,l=add(add(add(add(q,l),r),e[h]),
f[h]),q=o,o=n,n=k,k=add(p,l),p=j,j=i,i=g,g=add(l,m)}c[0]=add(g,c[0]);c[1]=add(i,c[1]);c[2]=add(j,c[2]);c[3]=add(p,c[3]);c[4]=add(k,c[4]);c[5]=add(n,c[5]);c[6]=add(o,c[6]);c[7]=add(q,c[7])}return d?c.slice(0,7):c},sha256InHex:function(a,b){return bin2hex(this.sha256(a,b))},sha224In94:function(a){return base94(this.sha256(a,!0))},hmacSha256:function(a,b,d){return this._hmacSha256(str2bin(a),a.length<<3,str2bin(b),b.length<<3,d)},_hmacSha256:function(a,b,d,c,e){512<b&&(a=this._sha256Hash(a,b,e));for(var f=
[],b=[],g=0;16>g;++g)f[g]=a[g]^909522486,b[g]=a[g]^1549556828;a=this._sha256Hash(f.concat(d),512+c,e);return this._sha256Hash(b.concat(a),512+(e?224:256),e)},hmacSha256InHex:function(a,b,d){return bin2hex(this.hmacSha256(a,b,d))},hmacSha224In94:function(a,b){return base94(this.hmacSha256(a,b,!0))}},app={name:"1Pass4All",version:"0.2.0"},debug=0;
Function.prototype.bind=function(a,b){for(var d=this,c=[],e=1;e<arguments.length;++e)c.push(arguments[e]);return function(){for(var b=[],e=0;e<c.length;++e)b.push(c[e]);for(e=0;e<arguments.length;++e)b.push(arguments[e]);return d.apply(a,b)}};function extend(a,b){if(!b)return a;for(var d in b)if(b.hasOwnProperty(d)){var c=b[d];void 0!==c&&(a[d]=c)}return a}function log(a){if(debug)try{console.log(a)}catch(b){alert(a)}}
function handleError(a,b){var d=a.message||"NO_MSG";log("exception happened("+b+"): "+d);alert(d)}function isVisible(a){if(0===a.offsetWidth||0===a.offsetHeight)return!1;for(;"body"!=a.nodeName.toLowerCase()&&(!a.style.display||"none"!=a.style.display.toLowerCase())&&(!a.style.visibility||"hidden"!=a.style.visibility.toLowerCase());)a=a.parentNode;return"body"==a.nodeName.toLowerCase()}
function setStyles(a,b){function d(a){return a.replace(/-([a-z])/gi,function(a,b){return b.toUpperCase()})}for(var c in b)if(b.hasOwnProperty(c)&&(a.style[d(c)]=b[c],"cssFloat"==c))a.style.styleFloat=b[c]}function setAttributes(a,b){for(var d in b)b.hasOwnProperty(d)&&a.setAttribute(d,b[d])}
function createElement(a,b,d,c,e){a=a||"div";e&&"type"in e&&document.all&&(a="<"+a+" type="+e.type+"/>",delete e.type);a=document.createElement(a);(b||document.body).appendChild(a);if(d)a.innerHTML=d;c&&setStyles(a,c);e&&setAttributes(a,e);return a}function clearFloat(a,b){createElement("div",a,null,extend({clear:"both"},b))}
function addCss(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.body.appendChild(b)}
var messages={lang:window.navigator.userLanguage||window.navigator.language,_msgs:{cmd_gen_pass:{en:"Generate password",zh:"\u751f\u6210\u5bc6\u7801"},cmd_clear_pass:{en:"Clear password",zh:"\u6e05\u9664\u5bc6\u7801"},label_domain:{en:"Domain(*):",zh:"\u57df\u540d\uff08*\uff09\uff1a"},label_user:{en:"Username:",zh:"\u7528\u6237\u540d\uff1a"},label_master_pass:{en:"Master password(*):",zh:"\u4e3b\u5bc6\u7801\uff08*\uff09\uff1a"},label_pass_len:{en:"Password length:",zh:"\u5bc6\u7801\u957f\u5ea6\uff1a"},
label_iteration:{en:"Iteration:",zh:"\u8fed\u4ee3\u6b21\u6570\uff1a"},label_salt:{en:"Salt:",zh:"\u76d0\uff08salt\uff09\uff1a"},label_result:{en:"Acutual password:",zh:"\u5b9e\u9645\u5bc6\u7801\uff1a"},error_no_domain:{en:"No domain found",zh:"\u672a\u627e\u5230\u57df\u540d"},error_empty_domain:{en:"Domain is empty",zh:"\u57df\u540d\u4e3a\u7a7a"},error_empty_pass:{en:"Password is empty",zh:"\u5bc6\u7801\u4e3a\u7a7a"},error_masterpass_too_short:{en:"Master password is too short(less than 6)",zh:"\u4e3b\u5bc6\u7801\u8fc7\u77ed\uff08\u5c0f\u4e8e6\u4f4d\uff09"},
error_empty_user:{en:"User field is empty",zh:"\u7528\u6237\u540d\u4e3a\u7a7a"},error_iteration_not_number:{en:"Hash iteration is not a number",zh:"hash\u8fed\u4ee3\u6b21\u6570\u5e94\u4e3a\u6570\u5b57"}},add:function(a){extend(this._msgs,a)},get:function(a){if(a=this._msgs[a]||""){var b=this.lang,d=b.indexOf("-");0<d&&(b=b.substring(0,d));a=a[b]||a.en}return a}},passCreator={PANEL_ID:"_1pass4all",MIN_PASS_LEN:8,MAX_PASS_LEN:26,VALID_PASS_RETRY:100,validate:function(a){log("validating password "+a);
if(!this._pwdPattern)this._pwdPattern=RegExp("^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{"+this.MIN_PASS_LEN+","+this.MAX_PASS_LEN+"}$");return this._pwdPattern.test(a)},generate:function(a,b,d,c,e){log("pwd="+a+";info="+b+";len="+d+";iteration="+c+";salt="+e);if(!d)d=this.settings.passLen;if(d<this.MIN_PASS_LEN)d=this.MIN_PASS_LEN;else if(d>this.MAX_PASS_LEN)d=this.MAX_PASS_LEN;a+=e||this.settings.salt||"";log("salted master pass: "+a);b=hasher.sha224In94(b);log("hashed info: "+b);e="";c=c||this.settings.iteration;
log("hash "+c+" times...");for(c-=1;0<c;--c)e=hasher.hmacSha224In94(e+a,b);for(c=0;;++c){e=hasher.hmacSha224In94(e+a,b);log("retry "+c+"; generated pass len="+e.length);var f=e.substring(0,d);if(c>this.VALID_PASS_RETRY||e.length>=d&&this.validate(f))return f}},createPasswordPanel:function(a,b,d){var c=2<arguments.length,e="#"+this.PANEL_ID+" {"+b.panelCss+"}",e=e+("#"+this.PANEL_ID+" label{"+b.labelCss+"}"),e=e+("#"+this.PANEL_ID+" input{"+b.inputCss+"}"),e=e+("#"+this.PANEL_ID+" button{"+b.buttonCss+
"}");addCss(e);this._panel=e=createElement(null,a,null,null,{id:this.PANEL_ID});if(c){c=createElement("div",e,null,b.titleBarStyle);createElement("span",c,this.settings.title,b.titleStyle);createElement("a",c,"&times",b.topBtnStyle).onclick=this._hide.bind(this);var f=createElement("a",c,"+",b.topBtnStyle);this._moreBtn=f;f.onclick=this._toggleMore.bind(this);clearFloat(c)}c=createElement("div",e,null,b.inputRegionStyle);createElement("label",c,messages.get("label_domain"));this._domainField=createElement("input",
c,null,null,{value:d&&d.domain||""});clearFloat(c,b.fldSepStyle);createElement("label",c,messages.get("label_user"));this._userField=createElement("input",c,null,null,{value:d&&d.user||""});clearFloat(c,b.fldSepStyle);createElement("label",c,messages.get("label_master_pass"));this._masterPassField=createElement("input",c,null,null,{type:"password",value:d&&d.pass||""});clearFloat(c,b.fldSepStyle);createElement("label",c,messages.get("label_pass_len"));this._passLenSelect=f=createElement("select",
c);for(var g=d&&d.passLen||this.settings.passLen,i=this.MIN_PASS_LEN;i<=this.MAX_PASS_LEN;++i){var j=createElement("option",f,i,null,{value:i});i==g&&j.setAttribute("selected","true")}clearFloat(c,b.fldSepStyle);this._advancedDiv=c=createElement("div",c,null,b.advancedDivStyle);createElement("label",c,messages.get("label_iteration"));this._iterationField=createElement("input",c,null,null,{value:d&&d.iteration||this.settings.iteration});clearFloat(c,b.fldSepStyle);createElement("label",c,messages.get("label_salt"));
this._saltField=createElement("input",c,null,null,{value:d&&d.salt||this.settings.salt});c=createElement("div",e,null,b.cmdDivStyle);createElement("button",c,messages.get("cmd_gen_pass"),b.genBtnStyle).onclick=this._genPass.bind(this);createElement("button",c,messages.get("cmd_clear_pass"),b.clearBtnStyle).onclick=this._clearPass.bind(this);clearFloat(c);this._resultDiv=c=createElement("div",e,null,b.resultDivStyle);createElement("label",c,messages.get("label_result"));this._genPassField=createElement("input",
c,null,b.genpassStyle,{readonly:"true"});this._errorDiv=createElement("div",e,null,b.errorDivStyle)},_toggleMore:function(){var a=this._advancedDiv;"none"==a.style.display?(a.style.display="block",this._moreBtn.innerHTML="-"):(a.style.display="none",this._moreBtn.innerHTML="+")},_hide:function(){if(this._panel)this._panel.style.display="none"},_genPass:function(){var a=this._domainField.value;if(a){var b=this._masterPassField.value;if(6>b.length)this.showError("error_masterpass_too_short");else{var d=
this._iterationField.value;isNaN(d)?this.showError("error_iteration_not_number"):(this.hideError(),this._genPassField.value=this.generate(b,this.getInfo(a,this._userField.value),this._passLenSelect.value,parseInt(d,10),this._saltField.value),this._resultDiv.style.display="block")}}else this.showError("error_empty_domain")},getInfo:function(a,b,d){for(var c="",e=0;e<arguments.length;++e)c+=arguments[e]||"";return c},_clearPass:function(){this._genPassField.value="";this._resultDiv.style.display="none"},
showError:function(a){this._resultDiv.style.display="none";this._errorDiv.innerHTML=messages.get(a);this._errorDiv.style.display="block"},hideError:function(){this._errorDiv.style.display="none"},settings:{title:app.name+" "+app.version,passLen:10,iteration:100,salt:"9rjixtK35p091K2glFZWDgueRFqmSNfX"}},onePassForAll_mobile={WRAPPER_ID:"_1pass4all_wrapper",main:function(){this._wrapper=document.getElementById(this.WRAPPER_ID);this._panel=passCreator.createPasswordPanel(this._wrapper,this.settings)},
settings:{panelCss:"margin: 0px auto; width: 100%;padding: 4px 0px; background-color: #FFF;",labelCss:"float: left; text-align: left; margin-left: 6px;padding: 2px 8px;font: bold 1em arial,verdana,sans-serif",inputCss:"width: 40%; border: none;margin: 3px 2px; padding: 2px",buttonCss:"background: #999; color: #FFFFFF; font-size: 1.2em;margin-top: 8px; padding: 2px 0; border: 1px solid silver;-moz-border-radius: 5px; -webkit-border-radius: 5px;border-radius: 5px; -khtml-border-radius: 5px",inputRegionStyle:{border:"1px solid silver",
"-moz-border-radius":"10px","-webkit-border-radius":"10px","border-radius":"10px","-khtml-border-radius":"10px","background-color":"#FFF"},fldSepStyle:{"border-bottom":"1px solid silver"},advancedDivStyle:{width:"100%"},cmdDivStyle:{width:"100%",margin:"2px auto"},genBtnStyle:{width:"100%"},clearBtnStyle:{display:"none"},resultDivStyle:{width:"100%",display:"none"},genpassStyle:{background:"transparent",color:"red",border:"0","font-weight":"bold"},errorDivStyle:{margin:"0 auto",width:"60%",font:"normal 10pt arial",
color:"red",display:"none"}}};window.test&&debug?log("in unit test"):onePassForAll_mobile.main();
})();
        </script>
    </body>
</html>
